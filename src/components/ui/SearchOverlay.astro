---
---

<dialog id="search-dialog" class="search-overlay fixed inset-0 w-full h-full max-w-none max-h-none m-0 p-0 bg-transparent open:flex open:items-start open:justify-center">
  <div class="w-full max-w-2xl mx-auto mt-[10vh] px-4">
    <div class="bg-cream dark:bg-dark-bg rounded-2xl shadow-xl overflow-hidden border border-cream-dark dark:border-dark-surface">
      <div class="flex items-center justify-between px-5 pt-4 pb-2">
        <span class="text-sm font-medium text-bark-light/60 dark:text-dark-text/50">Search</span>
        <button
          id="search-close"
          type="button"
          class="p-1 rounded-lg text-bark-light/40 dark:text-dark-text/40 hover:text-bark dark:hover:text-dark-text hover:bg-cream-dark dark:hover:bg-dark-surface transition-colors"
          aria-label="Close search"
        >
          <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
      <div id="search-container" class="px-5 pb-5"></div>
    </div>
  </div>
</dialog>

<script>
  const dialog = document.getElementById('search-dialog') as HTMLDialogElement;
  const closeBtn = document.getElementById('search-close');
  let pagefindInitialized = false;

  function openSearch() {
    dialog?.showModal();
    if (!pagefindInitialized && typeof (window as any).PagefindUI !== 'undefined') {
      new (window as any).PagefindUI({
        element: '#search-container',
        showImages: false,
        showSubResults: false,
        resetStyles: false,
      });
      pagefindInitialized = true;
    }
    setTimeout(() => {
      const input = dialog?.querySelector<HTMLInputElement>('.pagefind-ui__search-input');
      input?.focus();
    }, 100);
  }

  function closeSearch() {
    dialog?.close();
  }

  closeBtn?.addEventListener('click', closeSearch);

  dialog?.addEventListener('click', (e) => {
    if (e.target === dialog) closeSearch();
  });

  document.addEventListener('keydown', (e) => {
    if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
      e.preventDefault();
      dialog?.open ? closeSearch() : openSearch();
    }
  });

  // Expose for header button
  (window as any).__openSearch = openSearch;
</script>
