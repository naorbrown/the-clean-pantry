---
import PageLayout from '../../layouts/PageLayout.astro';
import Breadcrumb from '../../components/ui/Breadcrumb.astro';
import CategoryIcon from '../../components/ui/CategoryIcon.astro';
import { getCategories } from '../../lib/utils';
import { getCollection } from 'astro:content';

const categories = getCategories();
const allRecipes = await getCollection('recipes', ({ data }) => !data.draft);
let allGuides: any[] = [];
try { allGuides = await getCollection('guides', ({ data }) => !data.draft); } catch { /* empty */ }
---

<PageLayout title="Categories" description="Browse all categories — from kitchen cleaning to outdoor garden care.">
  <div class="max-w-6xl mx-auto px-4 sm:px-6 py-8 sm:py-12">
    <Breadcrumb items={[{ label: 'Categories' }]} />
    <h1 class="font-serif text-2xl sm:text-3xl font-bold text-bark dark:text-dark-text mt-4 mb-8">Categories</h1>

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
      {categories.map((cat) => {
        const recipeCount = allRecipes.filter((r) => r.data.category === cat.slug).length;
        const guideCount = allGuides.filter((g) => g.data.category === cat.slug).length;
        return (
          <a href={`/categories/${cat.slug}/`} class="group flex gap-4 p-5 rounded-xl bg-white dark:bg-dark-surface shadow-[var(--shadow-card)] hover:shadow-[var(--shadow-card-hover)] transition-all no-underline">
            <div class="flex-shrink-0 w-11 h-11 rounded-lg bg-sage-light/20 dark:bg-sage/10 flex items-center justify-center">
              <CategoryIcon slug={cat.slug} size="md" class="text-sage-dark dark:text-sage-light" />
            </div>
            <div class="min-w-0 flex-1">
              <h2 class="font-serif text-base font-semibold text-bark dark:text-dark-text group-hover:text-sage-dark dark:group-hover:text-sage-light transition-colors">{cat.name}</h2>
              <p class="text-sm text-bark-light/60 dark:text-dark-text/50 mt-0.5 line-clamp-2">{cat.description}</p>
              {(recipeCount > 0 || guideCount > 0) && (
                <p class="text-xs text-bark-light/40 dark:text-dark-text/30 mt-1.5">
                  {recipeCount > 0 && `${recipeCount} recipe${recipeCount !== 1 ? 's' : ''}`}
                  {recipeCount > 0 && guideCount > 0 && ' · '}
                  {guideCount > 0 && `${guideCount} guide${guideCount !== 1 ? 's' : ''}`}
                </p>
              )}
            </div>
          </a>
        );
      })}
    </div>
  </div>
</PageLayout>
