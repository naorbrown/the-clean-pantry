---
import PageLayout from '../../layouts/PageLayout.astro';
import Breadcrumb from '../../components/ui/Breadcrumb.astro';
import ContentCard from '../../components/ui/ContentCard.astro';
import { getCollection } from 'astro:content';
import { getSuperCategories, categoryLabel, url } from '../../lib/utils';

const allRecipes = await getCollection('recipes', ({ data }) => !data.draft);
const superCategories = getSuperCategories();
---

<PageLayout title="All Recipes" description="Browse all DIY natural home product recipes â€” simple, healthy, and effective.">
  <div class="max-w-6xl mx-auto px-4 sm:px-6 py-8 sm:py-12">
    <Breadcrumb items={[{ label: 'Recipes' }]} />
    <h1 class="text-2xl sm:text-3xl font-bold text-dark-text mt-4 mb-2">All Recipes</h1>
    <p class="text-dark-text/60 mb-10">Every recipe, grouped by category. Pick one and get mixing.</p>

    {superCategories.map((sc) => {
      const scRecipes = allRecipes.filter((r) => sc.subcategories.includes(r.data.category));
      if (scRecipes.length === 0) return null;
      return (
        <div class="mb-14">
          <div class="flex items-center gap-2 mb-6">
            <span class="text-xl">{sc.icon}</span>
            <h2 class="text-xl font-semibold text-dark-text">{sc.name}</h2>
          </div>
          {sc.subcategories.map((subSlug) => {
            const subRecipes = scRecipes.filter((r) => r.data.category === subSlug);
            if (subRecipes.length === 0) return null;
            return (
              <section class="mb-8 ml-2">
                <div class="flex items-center justify-between mb-4">
                  <h3 class="text-lg font-medium text-dark-text/80">{categoryLabel(subSlug)}</h3>
                  <a href={url(`/categories/${subSlug}/`)} class="text-xs text-sage-light no-underline hover:text-sage">View all &rarr;</a>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5">
                  {subRecipes.map((recipe) => (
                    <ContentCard
                      href={url(`/recipes/${recipe.id}/`)}
                      title={recipe.data.title}
                      description={recipe.data.description}
                      category={recipe.data.category}
                      type="recipe"
                      totalTime={recipe.data.totalTime}
                      difficulty={recipe.data.difficulty}
                      ingredientCount={recipe.data.ingredients.length}
                    />
                  ))}
                </div>
              </section>
            );
          })}
          <div class="section-divider"></div>
        </div>
      );
    })}
  </div>
</PageLayout>
