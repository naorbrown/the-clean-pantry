---
import PageLayout from '../../layouts/PageLayout.astro';
import Breadcrumb from '../../components/ui/Breadcrumb.astro';
import BrandIllustration from '../../components/ui/BrandIllustration.astro';
import { getCollection } from 'astro:content';
import { url } from '../../lib/utils';

const ingredients = await getCollection('ingredients');
const core = ingredients.filter((i) => i.data.category === 'core');
const secondary = ingredients.filter((i) => i.data.category === 'secondary');
const specialty = ingredients.filter((i) => i.data.category === 'specialty');

type IllustrationVariant = 'leaf' | 'bottle' | 'soap' | 'spray' | 'lemon' | 'herbs' | 'mortar' | 'drops';

const ingredientIllustration: Record<string, IllustrationVariant> = {
  'baking-soda': 'bottle',
  'castile-soap': 'soap',
  'white-vinegar': 'drops',
  'essential-oils': 'herbs',
  'hydrogen-peroxide': 'bottle',
  'washing-soda': 'mortar',
  'lemon-juice': 'lemon',
};

const sectionConfig = [
  { items: core, title: 'Core', subtitle: 'The essentials that handle 90% of household needs', color: 'bg-sage/8', accent: 'text-sage-light', border: 'border-sage/20' },
  { items: secondary, title: 'Secondary', subtitle: 'Useful additions for specific tasks', color: 'bg-honey/8', accent: 'text-honey', border: 'border-honey/20' },
  { items: specialty, title: 'Specialty', subtitle: 'For particular use cases and advanced recipes', color: 'bg-terracotta/8', accent: 'text-terracotta-light', border: 'border-terracotta/20' },
];
---

<PageLayout title="Ingredients" description="The essential ingredients for DIY natural home products — everything you need to know.">
  <div class="max-w-6xl mx-auto px-4 sm:px-6 py-8 sm:py-12">
    <Breadcrumb items={[{ label: 'Ingredients' }]} />

    <div class="mt-4 mb-10">
      <h1 class="text-2xl sm:text-3xl font-bold text-dark-text">The Pantry</h1>
      <p class="text-dark-text/60 mt-2 max-w-2xl">
        Everything you need to replace toxic household products — from the four essentials to specialty items.
      </p>
    </div>

    {sectionConfig.map(({ items, title, subtitle, color, accent, border }) => items.length > 0 && (
      <section class="mb-12">
        <div class="mb-5">
          <h2 class={`text-xl font-semibold ${accent}`}>{title}</h2>
          <p class="text-sm text-dark-text/50 mt-0.5">{subtitle}</p>
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
          {items.map((ing) => (
            <a href={url(`/ingredients/${ing.id}/`)} class={`group flex items-start gap-4 rounded-xl ${color} border ${border} p-5 no-underline hover:shadow-[var(--shadow-card)] transition-all`}>
              <div class="flex-shrink-0 w-10 h-10 rounded-lg bg-dark-surface/50 flex items-center justify-center">
                <BrandIllustration variant={ingredientIllustration[ing.id] || 'leaf'} class={`w-6 h-6 ${accent}/60 group-hover:${accent} transition-colors`} />
              </div>
              <div class="min-w-0">
                <h3 class="font-medium text-dark-text group-hover:text-sage-light transition-colors">
                  {ing.data.name}
                </h3>
                <p class="text-sm text-dark-text/60 mt-1 line-clamp-2">{ing.data.description}</p>
              </div>
            </a>
          ))}
        </div>
      </section>
    ))}
  </div>
</PageLayout>
